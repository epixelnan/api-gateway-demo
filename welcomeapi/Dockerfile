FROM golang:1.20
COPY src/go.mod /app/src/go.mod
# Made optional because sometimes this is not generated by `go mod sum`
COPY src/go.sum* /app/src/go.sum
WORKDIR /app/src/
RUN go mod download -x

WORKDIR /
COPY src /app/src

WORKDIR /app/src/
RUN go get
RUN go test ./...
# The generated binary fails to execute if cgo is enabled
RUN CGO_ENABLED=0 GOOS=linux go build

FROM alpine
COPY --from=0 /app/src/welcomeapi /app/
WORKDIR /app/
CMD ["./welcomeapi"]
